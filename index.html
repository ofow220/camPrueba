<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>CÃ¡mara del Celular - Streaming Frontal</title>
<style>
body {
padding: 0%;
    margin: 0%;
    background: #111;
    color: white;
    font-family: Arial, sans-serif;
    display: flex;
    flex-direction: column;
    align-items: center;
}
video {
    width: 90%;
    max-width: 500px;
    margin-top: 20px;
    border: 3px solid white;
    border-radius: 10px;
    transform: scaleX(-1); /* espejo para cÃ¡mara frontal */
}
button {
    margin: 10px;
    padding: 15px 25px;
    border: none;
    border-radius: 8px;
    background: #00aaff;
    color: white;
    font-size: 16px;
    cursor: pointer;
}
#status {
    margin-top: 10px;
    font-size: 15px;
    color: #0f0;
}
</style>
</head>
<body>

<h2>CÃ¡mara Frontal del Celular</h2>
<div id="status">Esperando permisos...</div>

<video id="video" autoplay playsinline></video>

<button onclick="takePhoto()">ðŸ“¸ Tomar Foto</button>
<button onclick="toggleRecording()">ðŸŽ¥ Grabar Video</button>

<script>
let wakeLock;
let stream;
let mediaRecorder;
let chunks = [];
let isRecording = false;

// Mantener la pantalla encendida
async function enableWakeLock() {
    try {
        wakeLock = await navigator.wakeLock.request("screen");
        document.getElementById("status").innerText = "Pantalla activa âœ”";
    } catch (err) {
        document.getElementById("status").innerText = "No se pudo evitar la suspensiÃ³n";
    }
}

// INICIAR CÃMARA
async function startCamera() {
    try {
        stream = await navigator.mediaDevices.getUserMedia({
            video: { facingMode: "user" }, // â†’ CÃ¡mara frontal
            audio: true
        });

        const video = document.getElementById("video");
        video.srcObject = stream;

        document.getElementById("status").innerText = "TransmisiÃ³n Activa âœ”";
        enableWakeLock();

    } catch (err) {
        document.getElementById("status").innerText =
            "Error: No se pudo acceder a la cÃ¡mara.";
        console.log(err);
    }
}

startCamera();

// FOTO
function takePhoto() {
    if (!stream) return;

    const video = document.getElementById("video");
    const canvas = document.createElement("canvas");

    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;

    const ctx = canvas.getContext("2d");
    ctx.drawImage(video, 0, 0);

    canvas.toBlob(blob => {
        const link = document.createElement("a");
        link.href = URL.createObjectURL(blob);
        link.download = "foto_frontal.jpg";
        link.click();
    }, "image/jpeg");
}

// GRABACIÃ“N
function toggleRecording() {
    if (!stream) return;

    if (!isRecording) {
        mediaRecorder = new MediaRecorder(stream);
        chunks = [];

        mediaRecorder.ondataavailable = e => chunks.push(e.data);
        mediaRecorder.onstop = () => {
            const blob = new Blob(chunks, { type: "video/mp4" });
            const link = document.createElement("a");
            link.href = URL.createObjectURL(blob);
            link.download = "grabacion_frontal.mp4";
            link.click();
        };

        mediaRecorder.start();
        isRecording = true;
        alert("GrabaciÃ³n iniciada âœ”");

    } else {
        mediaRecorder.stop();
        isRecording = false;
        alert("GrabaciÃ³n finalizada âœ”");
    }
}
</script>

</body>
</html>
